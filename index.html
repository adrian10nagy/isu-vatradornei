<!doctype html>
<html lang="ro">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DestinaÈ›ia locului producerii evenimentului È™i Mijloace care pot produce arderea</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <div class="container py-5">

      <!-- ðŸ” SEARCH GLOBAL -->
      <div class="card mb-4 border-2 border-primary">
        <div class="card-body">
          <label for="globalSearchInput" class="form-label fw-bold">
            <i class="bi bi-search me-1"></i> CÄƒutare cod / text Ã®n toate secÈ›iunile
          </label>
          <input
            type="text"
            id="globalSearchInput"
            class="form-control"
            placeholder="Ex: 5, Dormitor, È›igarÄƒ, conductori, autoaprindere..."
          />
          <div id="globalSearchResults" class="mt-3 list-group"></div>
        </div>
      </div>

      <!-- 1) DestinaÈ›ia locului producerii evenimentului -->
      <div class="accordion mb-4" id="sectiuneaLoc">
        <div class="accordion-item border-2 border-danger rounded-3 overflow-hidden">
          <h2 class="accordion-header" id="headingLoc">
            <button
              class="accordion-button collapsed bg-white"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapseLoc"
              aria-expanded="false"
              aria-controls="collapseLoc"
            >
              <span class="me-2 text-danger"><i class="bi bi-geo-alt"></i></span>
              DestinaÈ›ia locului producerii evenimentului
            </button>
          </h2>
          <div
            id="collapseLoc"
            class="accordion-collapse collapse"
            aria-labelledby="headingLoc"
            data-bs-parent="#sectiuneaLoc"
          >
            <div class="accordion-body bg-white">
              <!-- DOAR LISTA, fÄƒrÄƒ titlu intermediar -->
              <div id="listaLocatii" class="list-group"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 2) Sursa probabilÄƒ de aprindere -->
      <div class="accordion mb-4" id="sectiuneaSursa">
        <div class="accordion-item border-2 border-danger rounded-3 overflow-hidden">
          <h2 class="accordion-header" id="headingSursa">
            <button
              class="accordion-button collapsed bg-white"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapseSursa"
              aria-expanded="false"
              aria-controls="collapseSursa"
            >
              <span class="me-2 text-danger"><i class="bi bi-fire"></i></span>
              Sursa ProbabilÄƒ de Aprindere
            </button>
          </h2>
          <div
            id="collapseSursa"
            class="accordion-collapse collapse"
            aria-labelledby="headingSursa"
            data-bs-parent="#sectiuneaSursa"
          >
            <div class="accordion-body bg-white">
              <!-- DOAR LISTA -->
              <div id="listaSursaAprindere" class="list-group"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 3) Mijloace care pot produce arderea (are sub-secÈ›iuni) -->
      <div class="accordion mb-4" id="sectiuneaMijloaceWrapper">
        <div class="accordion-item border-2 border-danger rounded-3 overflow-hidden">
          <h2 class="accordion-header" id="headingMijloaceWrapper">
            <button
              class="accordion-button collapsed bg-white"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapseMijloaceWrapper"
              aria-expanded="false"
              aria-controls="collapseMijloaceWrapper"
            >
              <span class="me-2 text-danger"><i class="bi bi-fire"></i></span>
              Mijloace care pot produce arderea
            </button>
          </h2>
          <div
            id="collapseMijloaceWrapper"
            class="accordion-collapse collapse"
            aria-labelledby="headingMijloaceWrapper"
            data-bs-parent="#sectiuneaMijloaceWrapper"
          >
            <div class="accordion-body bg-white">
              <div class="accordion" id="mijloaceAccordion"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 4) Primul material care a ars (are sub-secÈ›iuni) -->
      <div class="accordion mb-4" id="sectiuneaMaterialWrapper">
        <div class="accordion-item border-2 border-danger rounded-3 overflow-hidden">
          <h2 class="accordion-header" id="headingMaterialWrapper">
            <button
              class="accordion-button collapsed bg-white"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapseMaterialWrapper"
              aria-expanded="false"
              aria-controls="collapseMaterialWrapper"
            >
              <span class="me-2 text-danger"><i class="bi bi-droplet-half"></i></span>
              Primul material care a ars
            </button>
          </h2>
          <div
            id="collapseMaterialWrapper"
            class="accordion-collapse collapse"
            aria-labelledby="headingMaterialWrapper"
            data-bs-parent="#sectiuneaMaterialWrapper"
          >
            <div class="accordion-body bg-white">
              <div class="accordion" id="materialArsAccordion"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 5) ÃŽmprejurarea determinantÄƒ (are sub-secÈ›iuni) -->
      <div class="accordion mb-4" id="sectiuneaImprejurariWrapper">
        <div class="accordion-item border-2 border-danger rounded-3 overflow-hidden">
          <h2 class="accordion-header" id="headingImprejurariWrapper">
            <button
              class="accordion-button collapsed bg-white"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapseImprejurariWrapper"
              aria-expanded="false"
              aria-controls="collapseImprejurariWrapper"
            >
              <span class="me-2 text-danger"><i class="bi bi-exclamation-triangle"></i></span>
              ÃŽmprejurarea determinantÄƒ
            </button>
          </h2>
          <div
            id="collapseImprejurariWrapper"
            class="accordion-collapse collapse"
            aria-labelledby="headingImprejurariWrapper"
            data-bs-parent="#sectiuneaImprejurariWrapper"
          >
            <div class="accordion-body bg-white">
              <div class="accordion" id="imprejurariAccordion"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- 1) FiÈ™ierul de date (locatiiData, sursaAprindereData, mijloaceData, primulMaterialData, imprejurariData) -->
    <script src="date.js"></script>

    <!-- 2) Script de randare -->
    <script>
  function renderSimpleList(containerId, dataArray, formatter) {
    const container = document.getElementById(containerId);
    if (!container || !Array.isArray(dataArray)) return;

    dataArray.forEach((item) => {
      const div = document.createElement("div");
      div.className = "list-group-item border-2 border-primary rounded-3 mb-2";
      div.innerHTML = formatter(item);
      container.appendChild(div);
    });
  }

  function renderAccordion(containerId, dataArray, iconDefault = "bi-list-ul") {
    const container = document.getElementById(containerId);
    if (!container || !Array.isArray(dataArray)) return;

    dataArray.forEach((cat, index) => {
      const headerId = `${containerId}Heading${index}`;
      const collapseId = `${containerId}Collapse${index}`;

      const item = document.createElement("div");
      item.className = "accordion-item border-2 border-danger rounded-3 overflow-hidden mb-2";

      const h2 = document.createElement("h2");
      h2.className = "accordion-header";
      h2.id = headerId;

      const button = document.createElement("button");
      button.className = "accordion-button collapsed bg-white";
      button.type = "button";
      button.setAttribute("data-bs-toggle", "collapse");
      button.setAttribute("data-bs-target", `#${collapseId}`);
      button.setAttribute("aria-expanded", "false");
      button.setAttribute("aria-controls", collapseId);

      const spanIcon = document.createElement("span");
      spanIcon.className = "me-2 text-danger";
      const icon = cat.icon || iconDefault;
      spanIcon.innerHTML = `<i class="bi ${icon}"></i>`;

      const titleNode = document.createTextNode(" " + cat.title);

      button.appendChild(spanIcon);
      button.appendChild(titleNode);
      h2.appendChild(button);

      const collapse = document.createElement("div");
      collapse.id = collapseId;
      collapse.className = "accordion-collapse collapse";
      collapse.setAttribute("aria-labelledby", headerId);
      collapse.setAttribute("data-bs-parent", `#${containerId}`);

      const body = document.createElement("div");
      body.className = "accordion-body bg-white";

      const listGroup = document.createElement("div");
      listGroup.className = "list-group";

      if (Array.isArray(cat.items)) {
        cat.items.forEach((it) => {
          const div = document.createElement("div");
          div.className = "list-group-item border-2 border-primary rounded-3 mb-2";
          div.innerHTML = `<strong>${it.code} â€“ ${it.label}</strong>`;
          listGroup.appendChild(div);
        });
      }

      body.appendChild(listGroup);
      collapse.appendChild(body);
      item.appendChild(h2);
      item.appendChild(collapse);

      container.appendChild(item);
    });
  }

  // Construim un index global pentru cÄƒutare
  function buildGlobalIndex(locatiiItems, sursaAprindereItems) {
    const index = [];

    const pushSimple = (items, sectionName) => {
      if (!Array.isArray(items)) return;
      items.forEach((it) => {
        index.push({
          section: sectionName,
          category: null,
          code: String(it.code),
          label: it.label || "",
        });
      });
    };

    pushSimple(locatiiItems, "DestinaÈ›ia locului producerii evenimentului");
    pushSimple(sursaAprindereItems, "Sursa probabilÄƒ de aprindere");

    if (Array.isArray(mijloaceData)) {
      mijloaceData.forEach((cat) => {
        (cat.items || []).forEach((it) => {
          index.push({
            section: "Mijloace care pot produce arderea",
            category: cat.title || "",
            code: String(it.code),
            label: it.label || "",
          });
        });
      });
    }

    if (Array.isArray(primulMaterialCareAAars)) {
      primulMaterialCareAAars.forEach((cat) => {
        (cat.items || []).forEach((it) => {
          index.push({
            section: "Primul material care a ars",
            category: cat.title || "",
            code: String(it.code),
            label: it.label || "",
          });
        });
      });
    }

    if (Array.isArray(imprejurariData)) {
      imprejurariData.forEach((cat) => {
        (cat.items || []).forEach((it) => {
          index.push({
            section: "ÃŽmprejurarea determinantÄƒ",
            category: cat.title || "",
            code: String(it.code),
            label: it.label || "",
          });
        });
      });
    }

    return index;
  }

  // UI pentru rezultate: grupare pe secÈ›iune, cu secÈ›iune micÄƒ sus È™i subsecÈ›iune + text dedesubt
  function renderSearchResults(resultsContainer, results, query) {
    resultsContainer.innerHTML = "";

    if (!query) {
      return;
    }

    if (!results.length) {
      const empty = document.createElement("div");
      empty.className = "text-muted small";
      empty.textContent = "Niciun rezultat gÄƒsit.";
      resultsContainer.appendChild(empty);
      return;
    }

    // GrupÄƒm rezultatele pe secÈ›iune
    const bySection = {};
    results.forEach((r) => {
      if (!bySection[r.section]) {
        bySection[r.section] = [];
      }
      bySection[r.section].push(r);
    });

    Object.entries(bySection).forEach(([sectionName, items]) => {
      const sectionBlock = document.createElement("div");
      sectionBlock.className = "mb-3";

      // Header mic de secÈ›iune (pÄƒrinte)
      const header = document.createElement("div");
      header.className =
        "d-inline-block px-2 py-1 rounded bg-primary bg-opacity-10 text-primary text-uppercase small fw-semibold mb-2";
      header.textContent = sectionName;
      sectionBlock.appendChild(header);

      const list = document.createElement("div");
      list.className = "list-group";

      items.forEach((r) => {
        const div = document.createElement("div");
        div.className = "list-group-item list-group-item-action py-2";

        const sectiuneSiSub = `${r.section}${
          r.category ? " â€“ " + r.category : ""
        }`;

        div.innerHTML = `
          <div class="small text-muted mb-1">
            ${sectiuneSiSub}
          </div>
          <div class="fw-bold">
            ${r.code} â€“ ${r.label}
          </div>
        `;

        list.appendChild(div);
      });

      sectionBlock.appendChild(list);
      resultsContainer.appendChild(sectionBlock);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Extragem ITEMS din structurile cu title+items pentru 1 È™i 2
    const locatiiItems =
      Array.isArray(locatiiData) && locatiiData[0]?.items
        ? locatiiData[0].items
        : locatiiData;

    const sursaAprindereItems =
      Array.isArray(sursaAprindereData) && sursaAprindereData[0]?.items
        ? sursaAprindereData[0].items
        : sursaAprindereData;

    // 1) LocaÈ›ii â€“ DOAR LISTA
    renderSimpleList(
      "listaLocatii",
      locatiiItems,
      (it) => `<strong>${it.code} â€“ ${it.label}</strong>`
    );

    // 2) Sursa probabilÄƒ â€“ DOAR LISTA
    renderSimpleList(
      "listaSursaAprindere",
      sursaAprindereItems,
      (it) => `<strong>${it.code} â€“ ${it.label}</strong>`
    );

    // 3) Mijloace care pot produce arderea (sub-accordion)
    renderAccordion("mijloaceAccordion", mijloaceData, "bi-fire");

    // 4) Primul material care a ars (sub-accordion)
    renderAccordion("materialArsAccordion", primulMaterialCareAAars, "bi-droplet-half");

    // 5) ÃŽmprejurarea determinantÄƒ (sub-accordion)
    renderAccordion("imprejurariAccordion", imprejurariData, "bi-exclamation-triangle");

    // ðŸ” Search global
    const globalIndex = buildGlobalIndex(locatiiItems, sursaAprindereItems);
    const searchInput = document.getElementById("globalSearchInput");
    const resultsContainer = document.getElementById("globalSearchResults");

    function handleGlobalSearch() {
      const raw = searchInput.value || "";
      const query = raw.trim().toLowerCase();
      resultsContainer.innerHTML = "";

      if (!query) return;

      const isNumber = !isNaN(query);
      const results = globalIndex.filter((entry) => {
        const codeMatch = isNumber && entry.code === query;
        const labelMatch = entry.label.toLowerCase().includes(query);
        const catMatch =
          entry.category && entry.category.toLowerCase().includes(query);
        const sectionMatch = entry.section.toLowerCase().includes(query);
        return codeMatch || labelMatch || catMatch || sectionMatch;
      });

      renderSearchResults(resultsContainer, results, query);
    }

    searchInput.addEventListener("input", handleGlobalSearch);
  });
</script>


    <!-- Bootstrap JS (obligatoriu pt. accordion/collapse) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  </body>
</html>
